#!/usr/bin/env bash
set -eo pipefail
[[ $DOKKU_TRACE ]] && set -x

# temporal:list
temporal:list() {
    debug_log "[temporal:list] Listing services from filesystem."
    debug_log "[temporal:list] PLUGIN_DATA_ROOT=$PLUGIN_DATA_ROOT"
    echo "Temporal Services:"

    local services
    services=$(service_list_all)
    debug_log "[temporal:list] Services returned: '$services'"

    if [ -z "$services" ]; then
        echo "  No Temporal services configured."
    else
        # Print each service on a new line with db type
        echo "$services" | while IFS= read -r service; do
            if [ -n "$service" ]; then
                local db_type
                db_type=$(service_info_get "$service" "DB_TYPE")
                if [ -n "$db_type" ]; then
                    echo "  - $service (db: $db_type)"
                else
                    echo "  - $service (db: unknown)"
                fi
            fi
        done
    fi
    return 0
}