#!/usr/bin/env bash

# Temporal start command

temporal:start() {
    local service_name="$1"
    
    if ! validate_service_name "$service_name" "start"; then
        return 1
    fi

    # Get all environment variables for the service
    local env_args=""
    while IFS= read -r line; do
        # Skip empty lines
        [ -z "$line" ] && continue
        # Escape any embedded double quotes in the value
        local key=$(echo "$line" | cut -d'=' -f1)
        local value=$(echo "$line" | cut -d'=' -f2-)
        env_args+=" -e ${key}=${value}"
    done < <(dokku config:export "$service_name")

    # Start Temporal server with all environment variables
    docker run -d \
        --name "temporal-server-$service_name" \
        --network temporal-network \
        -p 7233:7233 \
        $env_args \
        temporalio/auto-setup:latest

    echo "Temporal service '$service_name' started"
}
